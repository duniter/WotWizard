(* 
Util: Utility tools.

Copyright (C) 2017…2018 Gérard Meunier

This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License  for more details.

You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
*)

MODULE UtilExternal;
	
	

	IMPORT
		
		Dialog, WinApi;
	
	(* Do Command: Start program or Open file *)
	PROCEDURE Start* (IN file: ARRAY OF CHAR);
		
		VAR
			
			fullname: ARRAY 260 OF CHAR;
			res: INTEGER;
			np: WinApi.PtrWSTR;
		
		BEGIN (*Start*)
			res := WinApi.ShellExecuteW(0, '', file, '', '', WinApi.SW_SHOWNORMAL);
			IF res = WinApi.ERROR_FILE_NOT_FOUND THEN
				(* if failed then translate relative filenames to absolute filenames and try again *)
				res := WinApi.GetFullPathNameW(file, LEN(fullname), fullname, np);
				res := WinApi.ShellExecuteW(0, '', fullname, '', '', WinApi.SW_SHOWNORMAL);
			END;
			IF res <= 32 THEN
				Dialog.ShowParamMsg("#System:FailedToOpen", file, "", "")
			END;
		END Start;
	
	END UtilExternal.
