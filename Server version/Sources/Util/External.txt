MODULE UtilExternal;
	
	IMPORT
		
		Dialog, WinApi;
	
	(* Do Command: Start program or Open file *)
	PROCEDURE Start* (IN file: ARRAY OF CHAR);
		
		VAR
			
			fullname: ARRAY 260 OF CHAR;
			res: INTEGER;
			np: WinApi.PtrWSTR;
		
		BEGIN (*Start*)
			res := WinApi.ShellExecuteW(0, '', file, '', '', WinApi.SW_SHOWNORMAL);
			IF res = WinApi.ERROR_FILE_NOT_FOUND THEN
				(* if failed then translate relative filenames to absolute filenames and try again *)
				res := WinApi.GetFullPathNameW(file, LEN(fullname), fullname, np);
				res := WinApi.ShellExecuteW(0, '', fullname, '', '', WinApi.SW_SHOWNORMAL);
			END;
			IF res <= 32 THEN
				Dialog.ShowParamMsg("#System:FailedToOpen", file, "", "")
			END;
		END Start;
	
	END UtilExternal.
