(* 
Duniter0: WotWizard.

Copyright (C) 2017 GérardMeunier

This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License  for more details.

You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
*)

MODULE Duniter0QualitiesJson;
	
	
	
	IMPORT
		
		Q := Duniter0Qualities, 
		
		B := Duniter0Blockchain, J := UtilJson, Dialog, TextMappers, TextModels, TextViews, Views;
	
	PROCEDURE Print (dist: BOOLEAN);
		
		VAR
			
			props, propsId: Q.Props;
			i: INTEGER;
			s: Views.Title;
			t: TextModels.Model;
			f: TextMappers.Formatter;
		
		BEGIN (*Print*)
			Q.Count(dist, props, propsId);
			J.StartObject;
			IF dist THEN
				J.PushString("Distances");
			ELSE
				J.PushString("Qualities");
			END;
			J.BuildField("description");
			J.PushInteger(B.LastBlock());
			J.BuildField("block");
			J.StartArray;
			FOR i := 0 TO LEN(propsId) - 1 DO
				J.StartObject;
				J.PushString(propsId[i].id);
				J.BuildField("id");
				J.PushReal(100. * propsId[i].prop);
				IF dist THEN
					J.BuildField("distance");
				ELSE
					J.BuildField("quality");
				END;
				J.BuildObject;
			END;
			J.BuildArray;
			J.BuildField("values");
			J.BuildObject;
			t := TextModels.dir.New();
			f.ConnectTo(t);
			J.GetJson().Write(f);
			IF dist THEN
				Dialog.MapString("#Duniter0:Distances", s);
			ELSE
				Dialog.MapString("#Duniter0:Qualities", s);
			END;
			Views.OpenAux(TextViews.dir.New(t), s);
		END Print;
	
	PROCEDURE PrintQual*;
		
		BEGIN (*PrintQual*)
			Print(FALSE);
		END PrintQual;
	
	PROCEDURE PrintDist*;
		
		BEGIN (*PrintDist*)
			Print(TRUE);
		END PrintDist;
		
	END Duniter0QualitiesJson.

DevDebug.UnloadThis Duniter0QualitiesPrint Duniter0QualitiesJson Duniter0QualitiesSetsArr Duniter0QualitiesSetsAVL Duniter0QualitiesAVL 

Duniter0QualitiesJson.PrintDist;

Duniter0QualitiesJson.PrintQual;
